import{r as t,c as s,h as i,g as e}from"./p-221e9a50.js";import{D as h}from"./p-6088b4ad.js";const n=class{constructor(i){t(this,i),this.selectionIndex=0,this.isComposition=!1,this.showKeyboard=!1,this.chemInput=s(this,"chemInput",7),this.changeShowKeyboardState=s(this,"changeShowKeyboardState",7)}nbChemKeyboardTapHander(t){let s=this.inputDom;if(!s)return;let{selectionStart:i,selectionEnd:e,value:h}=s,{value:n,type:o}=t.detail,a=e-i;"DEL"===o&&(a||(i-=1,a+=1),n="");let l=h.split("");l.splice(i,a,n),h=l.join(""),this.selectionIndex=i+=n.length,this.updateInputValue(h)}inputChange(t){let s=this.inputDom;console.log(this.isComposition),s&&!this.isComposition&&(this.selectionIndex=s.selectionStart,this.updateInputValue(s.value))}updateInputValue(t){if(t)for(let s=0,i=(t=(t=t.replace(/=/g,"═")).replace(/\s*/g,"")).length;s<i;s++){let i=t[s],e=t[s-1];if(/[0-9]/.test(i)&&e)(/([A-Z]|[a-z]|\))/.test(e)||"₀₁₂₃₄₅₆₇₈₉".includes(e))&&(t=t.substr(0,s)+"₀₁₂₃₄₅₆₇₈₉"[i]+t.substr(s+1));else if(/[₀|₁|₂|₃|₄|₅|₆|₇|₈|₉]/.test(i)){if(!e||/[0-9]|\+|═|⇌|→|·|=/.test(e)){let e="₀₁₂₃₄₅₆₇₈₉".indexOf(i);t=t.substr(0,s)+e+t.substr(s+1)}}else if(/[a-z]/.test(i)&&(!e||/[0-9]|[₀|₁|₂|₃|₄|₅|₆|₇|₈|₉]|\+|═|⇌|→|·|=|\(/.test(e))){let e=i.toUpperCase();t=t.substr(0,s)+e+t.substr(s+1)}}this.inputValue=t,this.chemInput.emit({value:t,expressionValue:this.getExpressionValue(t)}),this.componentDidUpdate()}getExpressionValue(t){return t=(t=(t=(t=(t=t.replace(/═/g,"==")).replace(/⇌/g,"<>")).replace(/→/g,"->")).replace(/﹦/g,"||")).replace(/≡/g,"|||"),["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"].forEach((s,i)=>{let e=new RegExp(s,"g");t=t.replace(e,i)}),t}clear(){this.updateInputValue("")}componentDidLoad(){this.inputDom=h.domQuerySelector(this.ele,".input"),this.clear(),this.inputDom.addEventListener("compositionstart",()=>{this.isComposition=!0}),this.inputDom.addEventListener("compositionend",()=>{this.isComposition=!1})}componentDidUpdate(){let t=this.inputDom;t&&(t.value=this.inputValue,t.selectionStart!==this.selectionIndex&&(t.selectionStart=t.selectionEnd=this.selectionIndex,t.focus()))}changeShowKeyboard(){this.showKeyboard=!this.showKeyboard,this.changeShowKeyboardState.emit({state:this.showKeyboard})}render(){return i("div",{class:"chemInput"},i("div",{class:"inputBox"},i("input",{autofocus:"autofocus",class:"input",placeholder:"输入化学方程式",onInput:t=>{this.inputChange(t)}}),i("div",{style:{display:this.inputValue&&this.inputValue.length?"block":"none"},class:"icon clear",onClick:()=>{this.clear()}}),i("div",{class:"icon keyboard "+(this.showKeyboard?"active":""),onClick:()=>{this.changeShowKeyboard()}})),i("nb-chem-keyboard",{style:{display:this.showKeyboard?"block":"none"}}))}get ele(){return e(this)}static get style(){return".chemInput .inputBox .clear,.close_def{background-position:0 0}.chemInput .inputBox .clear,.chemInput .inputBox .clear:hover,.close_def,.close_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-input_sprite.png);background-size:34px 169px;background-repeat:no-repeat;width:14px;height:14px}.chemInput .inputBox .clear:hover,.close_hov{background-position:0 -19px}.chemInput .inputBox .clear:active,.close_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-input_sprite.png);background-size:34px 169px;background-repeat:no-repeat;background-position:0 -38px;width:14px;height:14px}.chemInput .inputBox .keyboard,.chemInput .inputBox .keyboard.active:active,.keyboard_def{background-image:url(assets/imgs/nbk/nbk_nb-chem-input_sprite.png);background-size:34px 169px;background-repeat:no-repeat;background-position:0 -57px;width:34px;height:34px}.chemInput .inputBox .keyboard.active:hover,.chemInput .inputBox .keyboard:hover,.keyboard_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-input_sprite.png);background-size:34px 169px;background-repeat:no-repeat;background-position:0 -96px;width:34px;height:34px}.chemInput .inputBox .keyboard.active,.chemInput .inputBox .keyboard:active,.keyboard_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-input_sprite.png);background-size:34px 169px;background-repeat:no-repeat;background-position:0 -135px;width:34px;height:34px}.chemInput .inputBox{width:456px;height:60px;background:#232628;border-radius:5px;border:1px solid #25282e;color:#ccc;display:-ms-flexbox;display:flex;margin-bottom:8px;-ms-flex-align:center;align-items:center}.chemInput .inputBox input{width:100%;font-size:20px;padding:12px;color:#ccc;border:none;outline:none;background:transparent}.chemInput .inputBox .icon{padding:0 8px;cursor:pointer}"}};export{n as nb_chem_input};